<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
    integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
    integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
    integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
    crossorigin="anonymous"></script>
</head>

<body>
  <div class="jumbotron">
    <h1>Welcome to our payment page!</h1>
    
    <!-- Display classId dynamically in the HTML -->
    <p>Class ID: <span id="classId"></span></p>
    <form id="paymentForm" method="POST">
      <!-- Add hidden input fields for userId and classId -->
      <input type="hidden" id="userId" name="userId" value="{{ userId }}">
      <input type="hidden" id="classIdInput" name="classId" value="{{ classId }}">
      <button type="button" class="btn btn-primary" id="donateButton">Pay</button>
    </form>

<!-- Add a script to set values for userId and classId -->
<script>
  // Extract userId and classId from the URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const classId = urlParams.get('classId');
  const userId = urlParams.get('userId');
  // Display classId in the HTML
  document.getElementById('classId').textContent = classId;

  // Set classId value in the hidden input field
  document.getElementById('classIdInput').value = classId;

  // Fetch userId from the hidden input field
  

  // Function to dynamically load Stripe Checkout.js based on classId
  function loadStripeCheckout(classId) {
    // Check if the script element already exists
    var existingScript = document.querySelector('.stripe-button');
    if (existingScript) {
      // If it exists, remove the existing script
      document.body.removeChild(existingScript);
    }

    // Create a script element
    var scriptElement = document.createElement('script');
    scriptElement.src = 'https://checkout.stripe.com/checkout.js';
    scriptElement.className = 'stripe-button';
    scriptElement.setAttribute('data-key', '{{ public_key }}');
    scriptElement.setAttribute('data-name', 'Run');
    scriptElement.setAttribute('data-locale', 'auto');
    scriptElement.setAttribute('data-zip-code', 'true');

    // Set dynamic details based on classId
    if (classId === '1') {
      scriptElement.setAttribute('data-amount', '5000');
    } else if (classId === '2') {
      scriptElement.setAttribute('data-amount', '6000');
    }
    // Add more conditions for other classIds as needed

    // Append the script element to the document body
    document.body.appendChild(scriptElement);

    // Add an event listener to redirect after Stripe Checkout.js is loaded
    scriptElement.addEventListener('load', function () {
      // When the Checkout.js script is loaded, open the Checkout pop-up
      var handler = StripeCheckout.configure({
        key: '{{ public_key }}',
        locale: 'auto',
        zipCode: true,
        token: function (token) {
          // You can handle the token here if needed
          console.log('Token:', token);

          // Redirect to the thankyou.html with parameters
          window.location.href = 'http://localhost:4242/thankyou?userId=' + userId + '&classId=' + classId;
        },
      });

      // Open the Checkout pop-up
      handler.open({
        name: 'Run',
        amount: scriptElement.getAttribute('data-amount'),
        currency: 'usd',  // Set the appropriate currency code
        closed: function () {
          // This function will be called when the pop-up is closed
          // You can perform additional actions here if needed
        },
      });
    });
  }

  // Add an event listener to the button
  document.getElementById('donateButton').addEventListener('click', function () {
    // Fetch class ID from the hidden input field
    const classId = document.getElementById('classIdInput').value;

    // Load Stripe Checkout.js dynamically based on classId
    loadStripeCheckout(classId);
  });
</script>




<!-- ... (Remaining HTML code) ... -->

  </div>
</body>

</html>
